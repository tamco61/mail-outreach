3. Архитектурная задача

Предложить архитектуру, которая позволит обслуживать 1200 email-адресов для аутрича (несколько клиентов, несколько направлений), с минимальной стоимостью инфраструктуры и высокой отказоустойчивостью.

В ответ включить:

• описание архитектуры;
• какие сервисы и подходы используются;
• как работает ротация и мониторинг;
• как распределяется нагрузка;
• риски и способы их закрытия;
• примерную оценку стоимости.

Объём: 0,5–1 страница текста.

1 Описание архитектуры
Система, состоит из следующих частей:
- SMTP-провайдер для рассылки сообщений
- Асинхронная очередь - для раздачи тасков вида (отправить с X почты письмо N на почту Y) воркерам
- Планировщик - микросервис, который пишет таски для воркеров в очередь
- Воркеры - микросервис, который забирает таски с очереди и обрабатывает их
- Аналитика - доставляемость, количество ошибок, заполняемость очереди, нагруженность адресов
- Контроллер - на основе метрик из аналитики меняет конфигурацию системы
- БД для хранения шаблонов писем, email адресов, расписаний  

Flow:
Планировщик отправляет таски в очередь -> воркер подхватывает таску -> 
получает ящик из активного пула email адресов -> высылает средствами SMTP провайдера письмо -> отчитывается по проделанной работе

2 Сервисы
В качестве SMTP провайдера возьмём Unisender, это сервис для массовой рассылки, который соответствует российским нормативам и может хранить данные в России.
Для разворачивания облачной инфраструктуры возьмём Yandex Cloud, в нём мы будем разворачивать большую часть нашей системы.
Yandex Object Storage - для хранение логов, шаблонов писем, вложений
Yandex Message Queue - очередь для задач
Yandex Managed Service for PostgreSQL - 
 - Списков email-адресов клиентов  
 - Статусов отправки  
 - Статистики и метрик  
 - Настроек ротации SMTP-аккаунтов
Yandex Serverless Containers - для обработки тасков  
Можно ограничится и просто ВМ Yandex Compute Cloud, но стоимость вырастит.

3 Ротация и мониторинг
Unisender может выполнять ротацию выделенных IP адресов для клиентов. Unisender также предоставляет встроенный функционал мониторинга, но при необходимости всегда можно докрутить Prometheus и Grafana.

4 Распределение нагрузки
Автомасштабирование по длине очереди, поднятие дополнительных воркеров.

5 Риски
 - Блокировка SMTP провайдером | ротация аккаунтов и ip адресов
 - Попадания адреса в спам лист | отслеживание доставляемости 

6 Оценка стоимости
 - Unisender ~ 3000 рублей
 - Yandex Cloud:
   - Object Storage + Query ~ 5000 рублей
   - PostgreSQL ~ 5000 рублей
   - Serverless Containers ~ 7500 рублей | Compute Cloud ~ 12500 рублей
 Итого: около 20500 - 25500 рублей.